#!/bin/bash

# Git commit-msg hook to enforce conventional commit standards
# - First line must start with a conventional commit type (feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert)
# - First line must be lowercase
# - First line must be ≤60 characters

msg=$(cat $1)
first_line=$(echo "$msg" | head -n1)

# Check if starts with type:
if ! echo "$first_line" | grep -qE '^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: '; then
    echo "Error: Commit message must start with a conventional commit type (e.g., feat:, fix:) followed by a space."
    exit 1
fi

# Check length
if [[ ${#first_line} -gt 60 ]]; then
    echo "Error: First line of commit message must be ≤60 characters."
    exit 1
fi

# Check lowercase
if [[ "$first_line" != "$(echo "$first_line" | tr '[:upper:]' '[:lower:]')" ]]; then
    echo "Error: First line of commit message must be lowercase."
    exit 1
fi

exit 0